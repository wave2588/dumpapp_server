package impl

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"

	"dumpapp_server/pkg/common/constant"
	"dumpapp_server/pkg/common/enum"
	util2 "dumpapp_server/pkg/common/util"
	"dumpapp_server/pkg/config"
	"dumpapp_server/pkg/controller"
	"dumpapp_server/pkg/dao"
	"dumpapp_server/pkg/dao/impl"
	"dumpapp_server/pkg/util"
)

type CertificateV2Controller struct {
	certificateDAO  dao.CertificateV2DAO
	memberDeviceDAO dao.MemberDeviceDAO
}

var DefaultCertificateV2Controller controller.CertificateController

func init() {
	DefaultCertificateV2Controller = NewCertificateV2Controller()
}

func NewCertificateV2Controller() *CertificateV2Controller {
	return &CertificateV2Controller{
		certificateDAO:  impl.DefaultCertificateV2DAO,
		memberDeviceDAO: impl.DefaultMemberDeviceDAO,
	}
}

type createResponse struct {
	Code int64       `json:"code"` ///
	Msg  string      `json:"msg"`  /// 添加成功
	Data interface{} `json:"data"`
}

type createDataResponse struct {
	ID                 string `json:"id"` /// 设备 id
	CertificateContent string `json:"certificateContent"`
	ProfileContent     string `json:"profileContent"`
}

func (c *CertificateV2Controller) CreateCer(ctx context.Context, UDID, regionPool string) *controller.CertificateResponse {
	/// regionPool 1 是私有 2 和 3 是共有
	res := &controller.CertificateResponse{}

	endpoint := config.DumpConfig.AppConfig.CerCreateURLV2
	requestBodyMap := map[string]interface{}{
		"token": config.DumpConfig.AppConfig.CerServerTokenV2,
		"udid":  UDID,
		"type":  1,
	}
	requestBody, _ := json.Marshal(requestBodyMap)
	body, err := util.HttpRequestV2("POST", endpoint, map[string]string{
		"Content-Type": "application/json",
	}, bytes.NewBuffer(requestBody))
	if err != nil {
		res.ErrorMessage = util2.StringPtr("v2 cer server fail")
		return res
	}
	fmt.Println(string(body))

	//body := `{"code":1,"msg":"\u6dfb\u52a0\u6210\u529f","data":{"id":"9205","certificateContent":"MIIFsTCCBJmgAwIBAgIQCKTJva67a8Y+XIy8OoVfRjANBgkqhkiG9w0BAQsFADB1MUQwQgYDVQQDDDtBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9ucyBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTELMAkGA1UECwwCRzMxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMB4XDTIyMDYyMDE0NDY0OFoXDTIzMDYyMDE0NDY0N1owgYwxGjAYBgoJkiaJk\/IsZAEBDApDRDRCVFhQRlFUMTYwNAYDVQQDDC1pUGhvbmUgRGlzdHJpYnV0aW9uOiBUaW5ndGluZyBTdSAoQ0Q0QlRYUEZRVCkxEzARBgNVBAsMCkNENEJUWFBGUVQxFDASBgNVBAoMC1Rpbmd0aW5nIFN1MQswCQYDVQQGEwJVUzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMLQzRDXPCJ7YBHtEBScTUCxWYJ3Q1hgtKwDvA7SkR5lEVRnmFumCaQOeic7UMOi9Y+bLXlpjWfbzIQWNFWwMyh5KdOKWtqUXMXCk5P\/y5e14EhVb1HoKyz70\/UQg3x1rDTYeF6Lq7EFKtkRLfmgqFWs87snufvjeGNkMDlyJA\/zaX9bvtxANcYGmm\/sEezJShMMJZkOhc6\/eQvIT0PmkWAyiiY1feL0OHExaAIQ5qFF5rNiBr6Siz5EteOGJWIP9dzSKOyg0G+hGAhWoCPyXpVqSfJOz\/I+0E6GrNJwD6KZaxFSa4NEhcGopJZYmDvwecyfjw7TCUCv1rY7U\/jTr80CAwEAAaOCAiMwggIfMAwGA1UdEwEB\/wQCMAAwHwYDVR0jBBgwFoAUCf7AFZD5r2QKkhK5JihjDJfsp7IwcAYIKwYBBQUHAQEEZDBiMC0GCCsGAQUFBzAChiFodHRwOi8vY2VydHMuYXBwbGUuY29tL3d3ZHJnMy5kZXIwMQYIKwYBBQUHMAGGJWh0dHA6Ly9vY3NwLmFwcGxlLmNvbS9vY3NwMDMtd3dkcmczMDIwggEeBgNVHSAEggEVMIIBETCCAQ0GCSqGSIb3Y2QFATCB\/zCBwwYIKwYBBQUHAgIwgbYMgbNSZWxpYW5jZSBvbiB0aGlzIGNlcnRpZmljYXRlIGJ5IGFueSBwYXJ0eSBhc3N1bWVzIGFjY2VwdGFuY2Ugb2YgdGhlIHRoZW4gYXBwbGljYWJsZSBzdGFuZGFyZCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBvZiB1c2UsIGNlcnRpZmljYXRlIHBvbGljeSBhbmQgY2VydGlmaWNhdGlvbiBwcmFjdGljZSBzdGF0ZW1lbnRzLjA3BggrBgEFBQcCARYraHR0cHM6Ly93d3cuYXBwbGUuY29tL2NlcnRpZmljYXRlYXV0aG9yaXR5LzAWBgNVHSUBAf8EDDAKBggrBgEFBQcDAzAdBgNVHQ4EFgQUJsWjDPxVErrdotyJ1zJxBnt28b8wDgYDVR0PAQH\/BAQDAgeAMBMGCiqGSIb3Y2QGAQQBAf8EAgUAMA0GCSqGSIb3DQEBCwUAA4IBAQCAAu04ua69Xa3DJEeGz+SqVnjLBQjveSEv9pi2E+L2mkJim9KQy3DGOuHHIaeSGJq4\/YU\/Jx6py0V06Gk3uSZfMjF815iI\/exhTISp9TTnq+oXdnlILZC0IgKdxDj0hKIHAbTPWYB8015CbawHYK\/5GQRkO+q\/vgs\/4NJUz8btqQAMvLd9XRAV9k0n9bqpAJDgniEoVwkq0b+xI6pb8Ss2ITOPgpBVPSHnx8pB37TE7wTShydyOqPN5piAxRCMKoOBHTS3G3E6t6sQolbePn5wfncL+MfnMl94\/e9ZaEZJ8VZphKlQUt1l7NdXk3gNCmqv\/TjecsLPLNKRAFrrV\/Gl","profileContent":"MIIvUQYJKoZIhvcNAQcCoIIvQjCCLz4CAQExCzAJBgUrDgMCGgUAMIIfXgYJKoZIhvcNAQcBoIIfTwSCH0s8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI\/Pgo8IURPQ1RZUEUgcGxpc3QgUFVCTElDICItLy9BcHBsZS8vRFREIFBMSVNUIDEuMC8vRU4iICJodHRwOi8vd3d3LmFwcGxlLmNvbS9EVERzL1Byb3BlcnR5TGlzdC0xLjAuZHRkIj4KPHBsaXN0IHZlcnNpb249IjEuMCI+CjxkaWN0PgoJPGtleT5BcHBJRE5hbWU8L2tleT4KCTxzdHJpbmc+QnVuZGxpZUFQSVRlc3Q8L3N0cmluZz4KCTxrZXk+QXBwbGljYXRpb25JZGVudGlmaWVyUHJlZml4PC9rZXk+Cgk8YXJyYXk+Cgk8c3RyaW5nPkNENEJUWFBGUVQ8L3N0cmluZz4KCTwvYXJyYXk+Cgk8a2V5PkNyZWF0aW9uRGF0ZTwva2V5PgoJPGRhdGU+MjAyMi0wNi0yMVQxMjo0Njo0MFo8L2RhdGU+Cgk8a2V5PlBsYXRmb3JtPC9rZXk+Cgk8YXJyYXk+CgkJPHN0cmluZz5pT1M8L3N0cmluZz4KCTwvYXJyYXk+Cgk8a2V5PklzWGNvZGVNYW5hZ2VkPC9rZXk+Cgk8ZmFsc2UvPgoJPGtleT5EZXZlbG9wZXJDZXJ0aWZpY2F0ZXM8L2tleT4KCTxhcnJheT4KCQk8ZGF0YT5NSUlGc1RDQ0JKbWdBd0lCQWdJUUNLVEp2YTY3YThZK1hJeThPb1ZmUmpBTkJna3Foa2lHOXcwQkFRc0ZBREIxTVVRd1FnWURWUVFERER0QmNIQnNaU0JYYjNKc1pIZHBaR1VnUkdWMlpXeHZjR1Z5SUZKbGJHRjBhVzl1Y3lCRFpYSjBhV1pwWTJGMGFXOXVJRUYxZEdodmNtbDBlVEVMTUFrR0ExVUVDd3dDUnpNeEV6QVJCZ05WQkFvTUNrRndjR3hsSUVsdVl5NHhDekFKQmdOVkJBWVRBbFZUTUI0WERUSXlNRFl5TURFME5EWTBPRm9YRFRJek1EWXlNREUwTkRZME4xb3dnWXd4R2pBWUJnb0praWFKay9Jc1pBRUJEQXBEUkRSQ1ZGaFFSbEZVTVRZd05BWURWUVFEREMxcFVHaHZibVVnUkdsemRISnBZblYwYVc5dU9pQlVhVzVuZEdsdVp5QlRkU0FvUTBRMFFsUllVRVpSVkNreEV6QVJCZ05WQkFzTUNrTkVORUpVV0ZCR1VWUXhGREFTQmdOVkJBb01DMVJwYm1kMGFXNW5JRk4xTVFzd0NRWURWUVFHRXdKVlV6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1MUXpSRFhQQ0o3WUJIdEVCU2NUVUN4V1lKM1ExaGd0S3dEdkE3U2tSNWxFVlJubUZ1bUNhUU9laWM3VU1PaTlZK2JMWGxwaldmYnpJUVdORld3TXloNUtkT0tXdHFVWE1YQ2s1UC95NWUxNEVoVmIxSG9LeXo3MC9VUWczeDFyRFRZZUY2THE3RUZLdGtSTGZtZ3FGV3M4N3NudWZ2amVHTmtNRGx5SkEvemFYOWJ2dHhBTmNZR21tL3NFZXpKU2hNTUpaa09oYzYvZVF2SVQwUG1rV0F5aWlZMWZlTDBPSEV4YUFJUTVxRkY1ck5pQnI2U2l6NUV0ZU9HSldJUDlkelNLT3lnMEcraEdBaFdvQ1B5WHBWcVNmSk96L0krMEU2R3JOSndENktaYXhGU2E0TkVoY0dvcEpaWW1EdndlY3lmanc3VENVQ3Yxclk3VS9qVHI4MENBd0VBQWFPQ0FpTXdnZ0lmTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVQ2Y3QUZaRDVyMlFLa2hLNUppaGpESmZzcDdJd2NBWUlLd1lCQlFVSEFRRUVaREJpTUMwR0NDc0dBUVVGQnpBQ2hpRm9kSFJ3T2k4dlkyVnlkSE11WVhCd2JHVXVZMjl0TDNkM1pISm5NeTVrWlhJd01RWUlLd1lCQlFVSE1BR0dKV2gwZEhBNkx5OXZZM053TG1Gd2NHeGxMbU52YlM5dlkzTndNRE10ZDNka2NtY3pNREl3Z2dFZUJnTlZIU0FFZ2dFVk1JSUJFVENDQVEwR0NTcUdTSWIzWTJRRkFUQ0IvekNCd3dZSUt3WUJCUVVIQWdJd2diWU1nYk5TWld4cFlXNWpaU0J2YmlCMGFHbHpJR05sY25ScFptbGpZWFJsSUdKNUlHRnVlU0J3WVhKMGVTQmhjM04xYldWeklHRmpZMlZ3ZEdGdVkyVWdiMllnZEdobElIUm9aVzRnWVhCd2JHbGpZV0pzWlNCemRHRnVaR0Z5WkNCMFpYSnRjeUJoYm1RZ1kyOXVaR2wwYVc5dWN5QnZaaUIxYzJVc0lHTmxjblJwWm1sallYUmxJSEJ2YkdsamVTQmhibVFnWTJWeWRHbG1hV05oZEdsdmJpQndjbUZqZEdsalpTQnpkR0YwWlcxbGJuUnpMakEzQmdnckJnRUZCUWNDQVJZcmFIUjBjSE02THk5M2QzY3VZWEJ3YkdVdVkyOXRMMk5sY25ScFptbGpZWFJsWVhWMGFHOXlhWFI1THpBV0JnTlZIU1VCQWY4RUREQUtCZ2dyQmdFRkJRY0RBekFkQmdOVkhRNEVGZ1FVSnNXakRQeFZFcnJkb3R5SjF6SnhCbnQyOGI4d0RnWURWUjBQQVFIL0JBUURBZ2VBTUJNR0NpcUdTSWIzWTJRR0FRUUJBZjhFQWdVQU1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ0FBdTA0dWE2OVhhM0RKRWVHeitTcVZuakxCUWp2ZVNFdjlwaTJFK0wybWtKaW05S1F5M0RHT3VISElhZVNHSnE0L1lVL0p4NnB5MFYwNkdrM3VTWmZNakY4MTVpSS9leGhUSVNwOVRUbnErb1hkbmxJTFpDMElnS2R4RGowaEtJSEFiVFBXWUI4MDE1Q2Jhd0hZSy81R1FSa08rcS92Z3MvNE5KVXo4YnRxUUFNdkxkOVhSQVY5azBuOWJxcEFKRGduaUVvVndrcTBiK3hJNnBiOFNzMklUT1BncEJWUFNIbng4cEIzN1RFN3dUU2h5ZHlPcVBONXBpQXhSQ01Lb09CSFRTM0czRTZ0NnNRb2xiZVBuNXdmbmNMK01mbk1sOTQvZTlaYUVaSjhWWnBoS2xRVXQxbDdOZFhrM2dOQ21xdi9UamVjc0xQTE5LUkFGcnJWL0dsPC9kYXRhPgoJPC9hcnJheT4KCgk8a2V5PkRFUi1FbmNvZGVkLVByb2ZpbGU8L2tleT4KCTxkYXRhPk1JSU5MUVlKS29aSWh2Y05BUWNDb0lJTkhqQ0NEUm9DQVFFeER6QU5CZ2xnaGtnQlpRTUVBZ0VGQURDQ0F1WUdDU3FHU0liM0RRRUhBYUNDQXRjRWdnTFRNWUlDenpBTURBZFdaWEp6YVc5dUFnRUJNQTBNQ0ZCUVVVTm9aV05yQVFIL01CQU1DbFJwYldWVWIweHBkbVVDQWdGc01CRU1DRkJzWVhSbWIzSnRNQVVNQTJsUFV6QVREQTVKYzFoamIyUmxUV0Z1WVdkbFpBRUJBREFYREFoVVpXRnRUbUZ0WlF3TFZHbHVaM1JwYm1jZ1UzVXdHd3dKUVhCd1NVUk9ZVzFsREE1Q2RXNWtiR2xsUVZCSlZHVnpkREFkREF4RGNtVmhkR2x2YmtSaGRHVVhEVEl5TURZeU1URXlORFkwTUZvd0hnd09WR1ZoYlVsa1pXNTBhV1pwWlhJd0RBd0tRMFEwUWxSWVVFWlJWREFmREE1RmVIQnBjbUYwYVc5dVJHRjBaUmNOTWpNd05qSXdNVFEwTmpRM1dqQWdEQmRRY205bWFXeGxSR2x6ZEhKcFluVjBhVzl1Vkhsd1pRd0ZRVVJJVDBNd0lRd0VUbUZ0WlF3Wk1EQXdNRGd4TVRBdE1EQXdRVGRFTWpFd1JVWkJPREF4UlRBckRCdEJjSEJzYVdOaGRHbHZia2xrWlc1MGFXWnBaWEpRY21WbWFYZ3dEQXdLUTBRMFFsUllVRVpSVkRBc0RBUlZWVWxFRENRMU5XSm1OekZtTUMwelltSmhMVFJtTVdFdE9EZGtZaTB3TVRFMVpqbGpORGN5TVdJd01Rd1NVSEp2ZG1semFXOXVaV1JFWlhacFkyVnpNQnNNR1RBd01EQTRNVEV3TFRBd01FRTNSREl4TUVWR1FUZ3dNVVV3T3d3VlJHVjJaV3h2Y0dWeVEyVnlkR2xtYVdOaGRHVnpNQ0lFSUFmL3NGNzJRMkU0TXZBdmpmMDB1NnJIbDRjYnA0V3VSVURTQ0ptZUFDOVZNSUhQREF4RmJuUnBkR3hsYldWdWRITndnYjRDQVFHd2diZ3dNd3dXWVhCd2JHbGpZWFJwYjI0dGFXUmxiblJwWm1sbGNnd1pRMFEwUWxSWVVFWlJWQzVqYjIwdVpIZ3laR291Y0RVeVlqQXhEQ05qYjIwdVlYQndiR1V1WkdWMlpXeHZjR1Z5TG5SbFlXMHRhV1JsYm5ScFptbGxjZ3dLUTBRMFFsUllVRVpSVkRBVERBNW5aWFF0ZEdGemF5MWhiR3h2ZHdFQkFEQTVEQlpyWlhsamFHRnBiaTFoWTJObGMzTXRaM0p2ZFhCek1COE1ERU5FTkVKVVdGQkdVVlF1S2d3UFkyOXRMbUZ3Y0d4bExuUnZhMlZ1b0lJSVBEQ0NBa013Z2dISm9BTUNBUUlDQ0MzRi9JalN4VXVWTUFvR0NDcUdTTTQ5QkFNRE1HY3hHekFaQmdOVkJBTU1Fa0Z3Y0d4bElGSnZiM1FnUTBFZ0xTQkhNekVtTUNRR0ExVUVDd3dkUVhCd2JHVWdRMlZ5ZEdsbWFXTmhkR2x2YmlCQmRYUm9iM0pwZEhreEV6QVJCZ05WQkFvTUNrRndjR3hsSUVsdVl5NHhDekFKQmdOVkJBWVRBbFZUTUI0WERURTBNRFF6TURFNE1Ua3dObG9YRFRNNU1EUXpNREU0TVRrd05sb3daekViTUJrR0ExVUVBd3dTUVhCd2JHVWdVbTl2ZENCRFFTQXRJRWN6TVNZd0pBWURWUVFMREIxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURVRNQkVHQTFVRUNnd0tRWEJ3YkdVZ1NXNWpMakVMTUFrR0ExVUVCaE1DVlZNd2RqQVFCZ2NxaGtqT1BRSUJCZ1VyZ1FRQUlnTmlBQVNZNlM4OVFIS2s3Wk1pY29FVEhOMFFsZkhGbzA1eDNCUVcyUTdscGdVcWQyUjdYMDQ0MDdzY1JMVi85UisyTW1KZHllbUVXMDh3VHhGYUFQMVlXQXlsOVE4c1RRZEhFM1hhbDVlWGJ6RmM3U3VkZXlBNzJMbFUyVjZacERwUkNqR2pRakJBTUIwR0ExVWREZ1FXQkJTN3NONmhXRE9JbXFTS21kNit2ZXV2MnNza3F6QVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BNEdBMVVkRHdFQi93UUVBd0lCQmpBS0JnZ3Foa2pPUFFRREF3Tm9BREJsQWpFQWcrbkJ4QlplR2wwMEdObnQ3L1JzRGdCR1M3amZza1lSeFEvOTVucU1vYVpyenNJRDFKejFrOFowdUdyZnFpTVZBakJ0Wm9vUXl0UU4xRS9OalVNK3RJcGpwVE51NDIzYUY3ZGtIOGhUSnZtSVluUTVDeGRieTFHb0RPZ1lBK2Vpc2lnd2dnTG1NSUlDYmFBREFnRUNBZ2d6RGU3NHYweG9MakFLQmdncWhrak9QUVFEQXpCbk1Sc3dHUVlEVlFRRERCSkJjSEJzWlNCU2IyOTBJRU5CSUMwZ1J6TXhKakFrQmdOVkJBc01IVUZ3Y0d4bElFTmxjblJwWm1sallYUnBiMjRnUVhWMGFHOXlhWFI1TVJNd0VRWURWUVFLREFwQmNIQnNaU0JKYm1NdU1Rc3dDUVlEVlFRR0V3SlZVekFlRncweE56QXlNakl5TWpJek1qSmFGdzB6TWpBeU1UZ3dNREF3TURCYU1ISXhKakFrQmdOVkJBTU1IVUZ3Y0d4bElGTjVjM1JsYlNCSmJuUmxaM0poZEdsdmJpQkRRU0EwTVNZd0pBWURWUVFMREIxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURVRNQkVHQTFVRUNnd0tRWEJ3YkdVZ1NXNWpMakVMTUFrR0ExVUVCaE1DVlZNd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFRR2E2UldiMzJmSjlIT05vNlNHMWJOVkRaa1NzbVVhSm42eVNCKzR2VllEOXppYXVzWlJ5OHU3enVrQWJRQkUwUjhXaWF0b0p3cEpZcmw1Z1p2VDN4YW80SDNNSUgwTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3SHdZRFZSMGpCQmd3Rm9BVXU3RGVvVmd6aUpxa2lwbmV2cjNycjlyTEpLc3dSZ1lJS3dZQkJRVUhBUUVFT2pBNE1EWUdDQ3NHQVFVRkJ6QUJoaXBvZEhSd09pOHZiMk56Y0M1aGNIQnNaUzVqYjIwdmIyTnpjREF6TFdGd2NHeGxjbTl2ZEdOaFp6TXdOd1lEVlIwZkJEQXdMakFzb0NxZ0tJWW1hSFIwY0RvdkwyTnliQzVoY0hCc1pTNWpiMjB2WVhCd2JHVnliMjkwWTJGbk15NWpjbXd3SFFZRFZSME9CQllFRkhwSHVqaUtGU1JJSWtiTnZvOGFKSHMwQXlwcE1BNEdBMVVkRHdFQi93UUVBd0lCQmpBUUJnb3Foa2lHOTJOa0JnSVJCQUlGQURBS0JnZ3Foa2pPUFFRREF3Tm5BREJrQWpBVkRLbU94cStXYVd1bm45MWMxQU5aYks1UzFHREdpM2JndDhXaThRbDg0SnJqYTdIamZESEVKM3Fuam9uOXEzY0NNR0V6SVBFcC8vbUhNcTRweUdROWRudFJwTklDTDNhK1lDS1I4ZFU2ZGR5MDRzWXFsdjdHQ2R4S1Q5VWs4UHpLc2pDQ0F3Y3dnZ0t0b0FNQ0FRSUNDQTllQ0Z5VGE5TkFNQW9HQ0NxR1NNNDlCQU1DTUhJeEpqQWtCZ05WQkFNTUhVRndjR3hsSUZONWMzUmxiU0JKYm5SbFozSmhkR2x2YmlCRFFTQTBNU1l3SkFZRFZRUUxEQjFCY0hCc1pTQkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFVE1CRUdBMVVFQ2d3S1FYQndiR1VnU1c1akxqRUxNQWtHQTFVRUJoTUNWVk13SGhjTk1qRXdOREUwTWpFek1qVXdXaGNOTWpVd05URXpNakV4TmpJMVdqQk9NU293S0FZRFZRUUREQ0ZYVjBSU0lGQnliM1pwYzJsdmJtbHVaeUJRY205bWFXeGxJRk5wWjI1cGJtY3hFekFSQmdOVkJBb01Da0Z3Y0d4bElFbHVZeTR4Q3pBSkJnTlZCQVlUQWxWVE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMERBUWNEUWdBRTRPKzdNUjBBRlJxanFKR3FsREJvd3NDNE9nVW9pbTFRZk90bFFvaHFZTG9VR05BQnZ0dW1CNFVkb3daZEt0YXFMT1ZHM1JSaGZkdGRvc1FKUnlNc0dxT0NBVTh3Z2dGTE1Bd0dBMVVkRXdFQi93UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVWVrZTZPSW9WSkVnaVJzMitqeG9rZXpRREtta3dRUVlJS3dZQkJRVUhBUUVFTlRBek1ERUdDQ3NHQVFVRkJ6QUJoaVZvZEhSd09pOHZiMk56Y0M1aGNIQnNaUzVqYjIwdmIyTnpjREF6TFdGemFXTmhOREF6TUlHV0JnTlZIU0FFZ1k0d2dZc3dnWWdHQ1NxR1NJYjNZMlFGQVRCN01Ia0dDQ3NHQVFVRkJ3SUNNRzBNYTFSb2FYTWdZMlZ5ZEdsbWFXTmhkR1VnYVhNZ2RHOGdZbVVnZFhObFpDQmxlR05zZFhOcGRtVnNlU0JtYjNJZ1puVnVZM1JwYjI1eklHbHVkR1Z5Ym1Gc0lIUnZJRUZ3Y0d4bElGQnliMlIxWTNSeklHRnVaQzl2Y2lCQmNIQnNaU0J3Y205alpYTnpaWE11TUIwR0ExVWREZ1FXQkJUbk13OXQ2NWRmNHgyK21QcmZkQVp1cHc2eW5EQU9CZ05WSFE4QkFmOEVCQU1DQjRBd0R3WUpLb1pJaHZkalpBd1RCQUlGQURBS0JnZ3Foa2pPUFFRREFnTklBREJGQWlFQTg0OS9PMTd5RjhrS0JjUk5wYkNOMG83YjRZTERkSFlyMmxHejNZaWRoZkVDSUNXMTRIdEtQcG9zR3Q0T2lsRGR5NXljTEc5aWZQMjZPaHducDltejU3MlRNWUlCMkRDQ0FkUUNBUUV3ZmpCeU1TWXdKQVlEVlFRRERCMUJjSEJzWlNCVGVYTjBaVzBnU1c1MFpXZHlZWFJwYjI0Z1EwRWdOREVtTUNRR0ExVUVDd3dkUVhCd2JHVWdRMlZ5ZEdsbWFXTmhkR2x2YmlCQmRYUm9iM0pwZEhreEV6QVJCZ05WQkFvTUNrRndjR3hsSUVsdVl5NHhDekFKQmdOVkJBWVRBbFZUQWdnUFhnaGNrMnZUUURBTkJnbGdoa2dCWlFNRUFnRUZBS0NCNlRBWUJna3Foa2lHOXcwQkNRTXhDd1lKS29aSWh2Y05BUWNCTUJ3R0NTcUdTSWIzRFFFSkJURVBGdzB5TWpBMk1qRXhNalEyTkRCYU1Db0dDU3FHU0liM0RRRUpOREVkTUJzd0RRWUpZSVpJQVdVREJBSUJCUUNoQ2dZSUtvWkl6ajBFQXdJd0x3WUpLb1pJaHZjTkFRa0VNU0lFSUJWdjVJVURDQXhwSzdvM2cvUlVnZzRVWCt2dkhtVVN5Y3VTd1JEYnRhcmdNRklHQ1NxR1NJYjNEUUVKRHpGRk1FTXdDZ1lJS29aSWh2Y05Bd2N3RGdZSUtvWklodmNOQXdJQ0FnQ0FNQTBHQ0NxR1NJYjNEUU1DQWdGQU1BY0dCU3NPQXdJSE1BMEdDQ3FHU0liM0RRTUNBZ0VvTUFvR0NDcUdTTTQ5QkFNQ0JFZ3dSZ0loQUl2R20xeHJ2OUJZOUJOcHFoYXkwanZZUEh0UDNGUkE2c2YxOEZJWDVVSHlBaUVBNWg2WHJwWDFBbWluVGtoOENYajVSeWxOK095VFNWWkJzY0JYSmxoMHFUVT08L2RhdGE+CgkJCQkJCQkJCQkJCQoJCQk8a2V5PlBQUUNoZWNrPC9rZXk+Cgk8dHJ1ZS8+CgoJPGtleT5FbnRpdGxlbWVudHM8L2tleT4KCTxkaWN0PgoJCQkJCgkJCQk8a2V5PmFwcGxpY2F0aW9uLWlkZW50aWZpZXI8L2tleT4KCQk8c3RyaW5nPkNENEJUWFBGUVQuY29tLmR4MmRqLnA1MmI8L3N0cmluZz4KCQkJCQoJCQkJPGtleT5rZXljaGFpbi1hY2Nlc3MtZ3JvdXBzPC9rZXk+CgkJPGFycmF5PgoJCQkJPHN0cmluZz5DRDRCVFhQRlFULio8L3N0cmluZz4KCQkJCTxzdHJpbmc+Y29tLmFwcGxlLnRva2VuPC9zdHJpbmc+CgkJPC9hcnJheT4KCQkJCQoJCQkJPGtleT5nZXQtdGFzay1hbGxvdzwva2V5PgoJCTxmYWxzZS8+CgkJCQkKCQkJCTxrZXk+Y29tLmFwcGxlLmRldmVsb3Blci50ZWFtLWlkZW50aWZpZXI8L2tleT4KCQk8c3RyaW5nPkNENEJUWFBGUVQ8L3N0cmluZz4KCQkKCTwvZGljdD4KCTxrZXk+RXhwaXJhdGlvbkRhdGU8L2tleT4KCTxkYXRlPjIwMjMtMDYtMjBUMTQ6NDY6NDdaPC9kYXRlPgoJPGtleT5OYW1lPC9rZXk+Cgk8c3RyaW5nPjAwMDA4MTEwLTAwMEE3RDIxMEVGQTgwMUU8L3N0cmluZz4KCTxrZXk+UHJvdmlzaW9uZWREZXZpY2VzPC9rZXk+Cgk8YXJyYXk+CgkJPHN0cmluZz4wMDAwODExMC0wMDBBN0QyMTBFRkE4MDFFPC9zdHJpbmc+Cgk8L2FycmF5PgoJPGtleT5UZWFtSWRlbnRpZmllcjwva2V5PgoJPGFycmF5PgoJCTxzdHJpbmc+Q0Q0QlRYUEZRVDwvc3RyaW5nPgoJPC9hcnJheT4KCTxrZXk+VGVhbU5hbWU8L2tleT4KCTxzdHJpbmc+VGluZ3RpbmcgU3U8L3N0cmluZz4KCTxrZXk+VGltZVRvTGl2ZTwva2V5PgoJPGludGVnZXI+MzY0PC9pbnRlZ2VyPgoJPGtleT5VVUlEPC9rZXk+Cgk8c3RyaW5nPjU1YmY3MWYwLTNiYmEtNGYxYS04N2RiLTAxMTVmOWM0NzIxYjwvc3RyaW5nPgoJPGtleT5WZXJzaW9uPC9rZXk+Cgk8aW50ZWdlcj4xPC9pbnRlZ2VyPgo8L2RpY3Q+CjwvcGxpc3Q+oIINPzCCBDQwggMcoAMCAQICCGPnHCGdGpMnMA0GCSqGSIb3DQEBCwUAMHMxLTArBgNVBAMMJEFwcGxlIGlQaG9uZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEgMB4GA1UECwwXQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMB4XDTIyMDMxNzIxMjkxOFoXDTI3MDMxNjIxMjkxN1owWTE1MDMGA1UEAwwsQXBwbGUgaVBob25lIE9TIFByb3Zpc2lvbmluZyBQcm9maWxlIFNpZ25pbmcxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvnjmR3QfNeNRKLiYW5H7b7OgpShgV5F5NQpsFKJp2Wnkgxnqs9GBo5EIfrce0KmomPcxRA+dl49zyEFo72oFUfx6c+AZfNay4don6rfLLI\/iGHtlmNJhWjwwJDt+CXHpPH6\/adTDYhhZwzGKe3fmIrUR40eYt+edjrmqYYGzkPE4TchPrAQl0kecqeboVINgAFq7QCM\/IBFtvOMt4aNhPI8\/4LBC37\/vQBh41JaEef8EcsdSnNh7h+08nAQI2xCJe10uIJm7q\/L9VQFo8C60bUJ3z3QEYi50VrObOQOwIjHdCr5CbGHd8qnThepeUial+8pMkcFnDooPi1TyOiFO7QIDAQABo4HlMIHiMAwGA1UdEwEB\/wQCMAAwHwYDVR0jBBgwFoAUb\/GVGGJc4Mjxxe1sGMng02RSmCAwQAYIKwYBBQUHAQEENDAyMDAGCCsGAQUFBzABhiRodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLWFpcGNhMDcwLwYDVR0fBCgwJjAkoCKgIIYeaHR0cDovL2NybC5hcHBsZS5jb20vYWlwY2EuY3JsMB0GA1UdDgQWBBRuqPK1KTk5L9f2j4aq1Ia3DmLXPDAOBgNVHQ8BAf8EBAMCB4AwDwYJKoZIhvdjZAY6BAIFADANBgkqhkiG9w0BAQsFAAOCAQEAraCEPzWc+wYnSGKfKKqmYINigx0vXEdpJxLabUjSr4vfgBeaDqTMtgpSMOXaKCkq+y9GJ7BOv5spvYJs3+ml5b87nRjMxAAq1XjGGfGCh3P+UL4HVDQCK4tnQO9FWUZP2sTGLUiHTFUIdLNwwQYsJrVPrp0KPznCVr\/3lwX9OfWSsQywwuLF1EmzNDR2oat8pATyS4U5A193WtxyLNkpBOSmkfJ3G9sFEQfhJSfANGfeeixrTLzBF+x9J29tKiUxgaPb4xlYLKFPR2Al3SEC\/hbVx9R4ZEqML4UxaFc8OvXdW5roAnuB66cWnqMXfaYGzjxGrBFESqmraKSkSDw4kzCCBEQwggMsoAMCAQICCFxjyuRKN1PJMA0GCSqGSIb3DQEBCwUAMGIxCzAJBgNVBAYTAlVTMRMwEQYDVQQKEwpBcHBsZSBJbmMuMSYwJAYDVQQLEx1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEWMBQGA1UEAxMNQXBwbGUgUm9vdCBDQTAeFw0xNzA1MTAyMTI3MzBaFw0zMDEyMzEwMDAwMDBaMHMxLTArBgNVBAMMJEFwcGxlIGlQaG9uZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEgMB4GA1UECwwXQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyUVqAQ8+gwSGx\/y\/3F7wHoHuFzBzYyYu3j16JM2TPk85R7p1vvPA0vFZoqsf\/gqGPNktmgfyDmu5KZEaXyIKi\/FyWAWuTEtExXmngDywiOCMDCeEXRnlhxk2y+PFdrew9EFyUfQFXINLom2mUbjxJt97Xq1lDMaymFGMu30bTMFOyAjH0u1kC7TdG41PQH0bj0iWklvz0Jh+2bykGQ6ZYbtBXQHMW3d6fSTQ3NNT\/8PcxZQstlpNjhgjOb3ZxlI+0fL0JYqhKof92AxGKVH\/7RdsiSVrh7+KaRSfd5\/DFbdos4hFvYTmBgJBZA+tKii4FcngrKeKunIENLJ4jPiyhQIDAQABo4HsMIHpMA8GA1UdEwEB\/wQFMAMBAf8wHwYDVR0jBBgwFoAUK9BpR5R2Cf70a40uQKb3R01\/CF4wRAYIKwYBBQUHAQEEODA2MDQGCCsGAQUFBzABhihodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLWFwcGxlcm9vdGNhMC4GA1UdHwQnMCUwI6AhoB+GHWh0dHA6Ly9jcmwuYXBwbGUuY29tL3Jvb3QuY3JsMB0GA1UdDgQWBBRv8ZUYYlzgyPHF7WwYyeDTZFKYIDAOBgNVHQ8BAf8EBAMCAQYwEAYKKoZIhvdjZAYCEgQCBQAwDQYJKoZIhvcNAQELBQADggEBADrPrJiNvpIgIQmtlfOxXCH6Ni1XIER0c2SSCLOWrPdtl\/pbNDgnzxJG0zwR8AfJmZCx0egRCaXjpWtsYwg\/niX61ZmcTOblzo6yTWjsi6ujok+KERU+3BQrHMZEtm9nxVtPlSkth1w\/3IMed0\/t2lSnLecTgcFjxFQLG0sKaigiCNQ3knx\/Zyhfrz0\/t6xZHTg0ZFruM0oZQkQpxMoYa+HBUy0t9E3CFfYzMhh48SZvik3rlEyj6P8PswOLZdrrLthlUJ\/cn4rfMaiEVNxSUkHSshMdMUZHiF8+7sPyjCMEleusij6CbAafLuOLQ5piWzQN9JnPLO66coYZI6X8jrUwggS7MIIDo6ADAgECAgECMA0GCSqGSIb3DQEBBQUAMGIxCzAJBgNVBAYTAlVTMRMwEQYDVQQKEwpBcHBsZSBJbmMuMSYwJAYDVQQLEx1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEWMBQGA1UEAxMNQXBwbGUgUm9vdCBDQTAeFw0wNjA0MjUyMTQwMzZaFw0zNTAyMDkyMTQwMzZaMGIxCzAJBgNVBAYTAlVTMRMwEQYDVQQKEwpBcHBsZSBJbmMuMSYwJAYDVQQLEx1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEWMBQGA1UEAxMNQXBwbGUgUm9vdCBDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOSRqQkfkdseR1DrBe1eeYQt6zaiV0xV7IsZid75S2z1B6siMALoGD74UAnTf0GomPnRymacJGsR0KO75Bsqwx+VnnoMpEeLW9QWNzPLxA9NzhRp0ckZcvVdDtV\/X5vyJQO6VY9NXQ3xZDUjFUsVWR2zlPf2nJ7PULrBWFBnjwi0IPfLrCwgb3C2PwEwjLdDzw+dPfMrSSgayP7OtbkO2V4c1ss9tTqt9A8OAJILsSEWLnTVPA3bYharo3GSR1NVwa8vQbP4++NwzeajTEV+H0xrUJZBicR0YgsQg0GHM4qBsTBY7FoEMoxos48d3mVz\/2deZbxJ2HafMxRloXeUyS0CAwEAAaOCAXowggF2MA4GA1UdDwEB\/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH\/MB0GA1UdDgQWBBQr0GlHlHYJ\/vRrjS5ApvdHTX8IXjAfBgNVHSMEGDAWgBQr0GlHlHYJ\/vRrjS5ApvdHTX8IXjCCAREGA1UdIASCAQgwggEEMIIBAAYJKoZIhvdjZAUBMIHyMCoGCCsGAQUFBwIBFh5odHRwczovL3d3dy5hcHBsZS5jb20vYXBwbGVjYS8wgcMGCCsGAQUFBwICMIG2GoGzUmVsaWFuY2Ugb24gdGhpcyBjZXJ0aWZpY2F0ZSBieSBhbnkgcGFydHkgYXNzdW1lcyBhY2NlcHRhbmNlIG9mIHRoZSB0aGVuIGFwcGxpY2FibGUgc3RhbmRhcmQgdGVybXMgYW5kIGNvbmRpdGlvbnMgb2YgdXNlLCBjZXJ0aWZpY2F0ZSBwb2xpY3kgYW5kIGNlcnRpZmljYXRpb24gcHJhY3RpY2Ugc3RhdGVtZW50cy4wDQYJKoZIhvcNAQEFBQADggEBAFw2mUwteLftjJvc83eb8nbSdzBPwR+Fg4UbmT1HN\/Kpm0COLNSxkBLYvvRzm+7SZA\/LeU802KI++Xj\/a8gH7H05g4tTINM4xLG\/mk8Ka\/8r\/FmnBQl8F0BWER5007eLIztHo9VvJOLr0bdw3w9F4SfK8W147ee1Fxeo3H4iNcol1dkP1mvUoiQjEfehrI9zgWDGG1sJL5Ky+ERI8GA4nhX1PSZnIIozavcNgs\/e66Mv+VNqW2TAYzN39zoHLFbr2g8hDtq6cxlPtdk2f8GHVdmnmbkyQvvY1XGefqFStxu9k0IkEirHDx22TZxeY8hLgBdQqorV2uT80AkHN7B1dSExggKFMIICgQIBATB\/MHMxLTArBgNVBAMMJEFwcGxlIGlQaG9uZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEgMB4GA1UECwwXQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTAghj5xwhnRqTJzAJBgUrDgMCGgUAoIHcMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTIyMDYyMTEyNDY0MFowIwYJKoZIhvcNAQkEMRYEFGn5d6IY9wUAIw8vDTt2LE2y3i27MCkGCSqGSIb3DQEJNDEcMBowCQYFKw4DAhoFAKENBgkqhkiG9w0BAQEFADBSBgkqhkiG9w0BCQ8xRTBDMAoGCCqGSIb3DQMHMA4GCCqGSIb3DQMCAgIAgDANBggqhkiG9w0DAgIBQDAHBgUrDgMCBzANBggqhkiG9w0DAgIBKDANBgkqhkiG9w0BAQEFAASCAQA3pqYkdAPkG7wdLcROoOIQmrwLEfxNROSiUVDDucktYEpqbXfJtd8bAjWuiuSoSCwBKwxyjrRSaGJ3dtk7yb6y6pzu1WgxCFcQUAGWYkDwas+OUgxLYBaXEbURYAnA89Du9AyGo8Ze8ibFcY93YgR9jjBtjQsDuev+FqMUhgNHB1w1yNV4X+DRmWm2DAs\/1LKcrLh9hxsyOEYGUlGp6943qOgXxl5AKSE5X3L8OOYfrLyyZWbXJTATNq7q6nwuQM201c6DiDqA5bTr8LXdXuV5DCO6fZVOsuyxYpPvNSNKfRJlwfqjKDYw+d9+R8UDVa3hJ4f3KtnAU6IMzVb4u7ZE"}}
	//`

	var response *createResponse
	err = json.Unmarshal([]byte(body), &response)
	if err != nil {
		res.ErrorMessage = util2.StringPtr("v2 response body json.unmarshal fail")
		return res
	}
	if response.Code != 1 {
		res.ErrorMessage = util2.StringPtr(fmt.Sprintf("v2 cer server error：%s", response.Msg))
		return res
	}
	d, err := json.Marshal(response.Data)
	if err != nil {
		res.ErrorMessage = util2.StringPtr("v2 json.Marshal(response.Data) fail")
		return res
	}
	var responseData *createDataResponse
	err = json.Unmarshal(d, &responseData)
	if err != nil {
		res.ErrorMessage = util2.StringPtr("v2 responseData json.Unmarshal fail")
		return res
	}

	cerData := c.getCerByServer(ctx, responseData.ID)
	if cerData.ErrorMessage != nil {
		res.ErrorMessage = cerData.ErrorMessage
		return res
	}
	return &controller.CertificateResponse{
		P12Data:             cerData.Data.P12,
		MobileProvisionData: cerData.Data.Mobileprovision,
		Source:              enum.CertificateSourceV2,
		BizExt: &constant.CertificateBizExt{
			V2DeviceID:          responseData.ID,
			OriginalP12Password: cerData.Data.Password,
			NewP12Password:      "123",
		},
	}
}

type getCerResponse struct {
	Code int                 `json:"code"`
	Msg  string              `json:"msg"`
	Data *getCerDataResponse `json:"data"`

	ErrorMessage *string `json:"error_message"`
}

type getCerDataResponse struct {
	Mobileprovision string `json:"mobileprovision"` /// 描述文件 base64 位编码
	P12             string `json:"p12"`             /// p12文件 base64 位编码内容
	Password        string `json:"password"`        /// 证书密码
	AppleDeviceID   string `json:"deviceId"`        /// 苹果平台设备 ID
}

func (c *CertificateV2Controller) getCerByServer(ctx context.Context, id string) *getCerResponse {
	res := &getCerResponse{}
	endpoint := config.DumpConfig.AppConfig.CerGetV2
	requestBodyMap := map[string]interface{}{
		"token": config.DumpConfig.AppConfig.CerServerTokenV2,
		"page":  1,
		"id":    id,
	}
	requestBody, _ := json.Marshal(requestBodyMap)
	body, err := util.HttpRequestV2("POST", endpoint, map[string]string{
		"Content-Type": "application/json",
	}, bytes.NewBuffer(requestBody))
	if err != nil {
		res.ErrorMessage = util2.StringPtr(fmt.Sprintf("v2 get_cer_by_server fail.  id: %s", id))
		return res
	}
	err = json.Unmarshal(body, &res)
	if err != nil {
		res.ErrorMessage = util2.StringPtr(fmt.Sprintf("v2 get_cer_by_server json.Unmarshal fail.  id: %s", id))
		return res
	}
	if res.Code != 1 {
		res.ErrorMessage = util2.StringPtr(fmt.Sprintf("v2 get_cer_by_server code != 1.  id: %s", id))
		return res
	}
	return res
}

func (c *CertificateV2Controller) CheckCerIsActive(ctx context.Context, certificateID int64) (bool, error) {
	cerMap, err := c.certificateDAO.BatchGet(ctx, []int64{certificateID})
	if err != nil {
		return false, err
	}
	cer, ok := cerMap[certificateID]
	if !ok {
		return false, nil
	}

	var cerBizExt *constant.CertificateBizExt
	err = json.Unmarshal([]byte(cer.BizExt), &cerBizExt)
	if err != nil {
		return false, err
	}

	memberDeviceMap, err := c.memberDeviceDAO.BatchGet(ctx, []int64{cer.DeviceID})
	if err != nil {
		return false, err
	}
	memberDevice, ok := memberDeviceMap[cer.DeviceID]
	if !ok {
		return false, nil
	}

	response, err := c.getCertificates(ctx, memberDevice.Udid)
	if err != nil {
		return false, err
	}

	/// 为请求成功默认证书无效
	if response.Code != 1 {
		return false, nil
	}

	/// 因为根据一个 udid 能拿到一批证书，所以需要遍历一下。
	isActive := false
	for _, datum := range response.Data {
		if datum.ID == cerBizExt.V2DeviceID && datum.Status == 1 {
			isActive = true
		}
	}

	return isActive, nil
}

type getDeviceListResponse struct {
	Code int                      `json:"code"` /// 1 代表请求成功
	Data []*getDeviceDataResponse `json:"data"`
}

type getDeviceDataResponse struct {
	ID     string `json:"id"`     /// id
	Status int    `json:"status"` /// 证书是否有效，1 为有效
}

func (c *CertificateV2Controller) getCertificates(ctx context.Context, UDID string) (*getDeviceListResponse, error) {
	endpoint := config.DumpConfig.AppConfig.CerGetDeviceListV2
	requestBodyMap := map[string]interface{}{
		"token": config.DumpConfig.AppConfig.CerServerTokenV2,
		"udid":  UDID,
	}
	requestBody, _ := json.Marshal(requestBodyMap)
	body, err := util.HttpRequestV2("POST", endpoint, map[string]string{
		"Content-Type": "application/json",
	}, bytes.NewBuffer(requestBody))
	if err != nil {
		return nil, err
	}

	var response getDeviceListResponse
	err = json.Unmarshal(body, &response)
	if err != nil {
		return nil, err
	}
	return &response, nil
}
